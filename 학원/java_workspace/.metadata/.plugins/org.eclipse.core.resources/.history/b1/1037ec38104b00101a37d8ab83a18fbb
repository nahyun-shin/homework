package test02.file;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.util.HashMap;
import java.util.Map;

import test02.data.Infor;

public class BankFile {

	public final String FILE_NAME = "customerAccount.txt";

	//문자타입의 Infor클래스가 오류가 나면 던져라. throws는 return값이 있어야함
	public Map<String, Infor> getAllInfor() throws Exception{

		//파일유무검사
		if(!isEmpty()) {
			//throw는 리턴값이 없어도 됨. 바로 Exception으로 던지기 때문
			throw new Exception("파일 없음.");
		}
		//중복체크를 하기위해 Infor class를 Map으로 만듬
		Map<String, Infor> inforMap = new HashMap<String, Infor>();

		
		//파일읽기
		//r 로 변수선언, 버퍼드 br 변수선언
		try(FileReader r = new FileReader(FILE_NAME);
				BufferedReader br = new BufferedReader(r);){

			//라인을 읽을 변수선언
			String inforStr ="";

			//라인에 읽을게 있을 때 까지 반복
			while ((inforStr = br.readLine()) != null) {
				//inforStr에 담길 문자를 콤마로 구분 하여 str배열에 담음
				String[] str = inforStr.split(",");
				//저장할 객체 변수 선언
				Infor inf = new Infor();

				inf.setBankBook(str[0]);
				//FILE_NAME에 적힌 문자를 long타입으로 변환하여 배열str[1]에 저장
				inf.setBankCash(Long.parseLong(str[1]));
				//Map으로 str[0]에 있는 키에 inf 값을 넣는다.
				inforMap.put(str[0], inf);
			}
			System.out.println("계좌 정보를 출력하였습니다.");
		}catch (Exception e) {
			//예외가 발생했을 때, 예외의 상세 정보를 콘솔에 출력해주는 메서드
			e.printStackTrace();
			// e.getMessage() 가 null과 같다면 ture일때 e.getMessage()출력 flase일때 "파일 읽기 오류" 출력
			System.out.println(e.getMessage() == null ? "파일 읽기 오류" : e.getMessage());
		}
		//inforMap으로 돌아감
		return inforMap;
	}
	
	public boolean isEmpty() throws Exception{
		//exists() - 파일이 실제 존재하는지의 여부만 확인
		return new File(FILE_NAME).exists();
	}
}