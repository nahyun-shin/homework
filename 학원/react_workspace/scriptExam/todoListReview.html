<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body{
            background-color: rgb(238, 238, 238);
        }
        .container{
            margin-top: 20px;
            height: 95vh;
            display: flex;
            justify-content: center;
            padding: 2rem 2rem;
        }
        .header{
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .contents{
            width: 75%;
            height: 100%;
            border: none;
            box-shadow: 1px 1px 15px 2px #fff,
                        -1px 0px 10px 8px #fff;
            border-radius: 15px;
            padding: 2rem 2rem;
            min-width: 600px;
            min-height: 600px;
            display: flex;
            flex-direction: column;


        }

        .work-status{
            text-align: right;
            font-size: 1.2rem;
        }

        .todo-list{
            width: 100%;
            height: 90%;
            background-color: rgb(235, 235, 235);
            border-radius: 10px;
            overflow: auto;
            display: flex;
            flex-direction: column;
            padding: 1rem 1rem;
        }
        .todo{
            display: flex;
            flex-direction: row;
            height: 70px;
            border-radius: 10px;
            background-color: #fff;
            padding: 1rem 1rem;
            align-items: center;
            justify-content: center;
        }

        .todo .item1{
            flex: 1;
        }
        .todo .item2{
            flex: 2;
            height: 70px;
            line-height: 70px;
        }
        .todo .item3{
            flex: 1;
        }
        .complete{
            background-color: #eeeeee;
        }
    </style>
</head>
<body>
    <main class="container">
        <section class="contents">
            <header class="header mb-3">
                <p>TodoList</p>
            </header>
            <section class="work-status mb-3 text-end">
                <p>할 일 : <span id="todoCount">0</span></p>
                <p>한 일 : <span id="doneCount">0</span></p>
                <p>달성률 : <span id="donePersent">0</span>%</p>
            </section>
            <section class="todo-input mb-4">
                <div class="row">
                    <div class="col-8">
                        <input type="text" class="form-control" id="inputTodo">
                    </div>
                    <div class="col-4">
                        <button type="button" class="btn btn-primary" onclick="createTodo()">등록</button>
                        <button type="button" class="btn btn-success" onclick="allCheckTodo()">일괄 완료</button>
                        <button type="button" class="btn btn-danger" onclick="allDelTodo()">일괄 삭제</button>
                    </div>
                </div>
            </section>
            <section class="todo-list">
                <!--todoList template 들어갈곳-->
            </section>
        </section>
    </main>
    <template id="todoTemplate">
        <div class="todo mb-2">
            <div class="item1">
                <input type="checkbox">
            </div>
            <div class="item2">
                <p id="todoJob"></p>
            </div>
            <div class="item3 text-end">
                <button type="button" class="btn btn-success">완료</button>
                <button type="button" class="btn btn-danger">삭제</button>
            </div>
        </div>
    </template>
</body>
<script>
    const createTodo=()=>{
        const inputTodo =document.querySelector('#inputTodo');
        if(inputTodo.value.trim().length===0){
            alert('할일을 입력하십시오')
            inputTodo.focus();
            return false;
        }

        const commonTemplate=document.querySelector('#todoTemplate');
        const todoTemlate =commonTemplate.content.cloneNode(true);
        drawTodoList(inputTodo.value, todoTemlate);
    }

    const allCheckTodo=(e)=>{
        const todoList = document.querySelectorAll('.todo-list .todo');
        //필터 걸어야함 근데 todoList는 순수 배열이 아님 >배열로 변경
        const doList =Array.from(todoList)
        .filter(todo => !todo.classList.contains('complete'))
        .filter(todo => todo.querySelector('input[type="checkbox"]:checked'));
         //node를 변경

        if(doList.length ===0){
            alert('일괄처리할 일정을 체크해주세요');
            return false;
        }
        doList.forEach(obj =>{
            const checkbox= obj.querySelector('input[type="checkbox"]');
            const todoItem =obj.querySelector('#todoJob');
            const doneBtn = obj.querySelector('.btn-success');

            todoItem.style = 'text-decoration:line-through';
            doneBtn.disabled = true;
            checkbox.checked =true;
            

            obj.classList.add('complete');
        })

        changeStatus();

    }
    const allDelTodo=(e)=>{
        const todoList = document.querySelectorAll('.todo-list .todo');
        //필터 걸어야함 근데 todoList는 순수 배열이 아님 >배열로 변경
        const doList =Array.from(todoList)
        .filter(todo => !todo.classList.contains('complete'))
        .filter(todo => todo.querySelector('input[type="checkbox"]:checked'));
         //node를 변경

         const chkCount = doList.closest('#todoTemplate');

        if(doList.length ===0){
            alert('일괄삭제할 일정을 체크해주세요');
            return false;
        }
        const isConfirm = confirm('정말 삭제하시겠습니까?');
        if(isConfirm){
            chkCount.remove();
        }

        changeStatus();

    }

    function drawTodoList(todo, template){
        const checkbox= template.querySelector('input[type="checkbox"]');
        const todoItem =template.querySelector('#todoJob');
        const doneBtn = template.querySelector('.btn-success');
        const delBtn=template.querySelector('.btn-danger');

        checkbox.name='todoChk';
        //문자집어넣기
        todoItem.textContent = todo;

        const TodoList= document.querySelector('.todo-list');
        TodoList.appendChild(template);

        doneBtn.addEventListener('click', (e)=>{
            todoItem.style = 'text-decoration:line-through';
            doneBtn.disabled = true;

            //todo목록 영역 최상위 가져오기
            const todoDiv= e.currentTarget.closest('.todo');
            todoDiv.classList.add('complete');
            
            checkbox.checked =true;
            
            //완료시 변경
            changeStatus();
        })
        delBtn.addEventListener('click',(e)=>{
            const isConfirm = confirm('정말 삭제하시겠습니까?');
            if(isConfirm){
                const todoDiv= e.currentTarget.closest('.todo');
                todoDiv.remove();
                //삭제시 변경
                changeStatus();
            }
        })
        //단순 등록시 변경
        changeStatus();
    }

    function changeStatus(){
        const todoList = document.querySelector('.todo-list').querySelectorAll('.todo');
        const doneList = document.querySelector('.todo-list').querySelectorAll('.todo.complete');

        const allTodoCount=todoList.length;
        const doneTodoCount=doneList.length;
        const persent=((doneTodoCount/allTodoCount)*100).toFixed(2);

        const todoSpan = document.querySelector('#todoCount');
        const doneSpan = document.querySelector('#doneCount');
        const persentSpan = document.querySelector('#donePersent');
        
        todoSpan.textContent = allTodoCount -doneTodoCount;
        doneSpan.textContent = doneTodoCount;
        persentSpan.textContent = parseFloat(persent);
    }
</script>
</html>